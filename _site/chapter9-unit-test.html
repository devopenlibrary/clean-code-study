<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(10)) > a, .site-nav > ul.nav-list:first-child > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(10) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(10) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(10) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>9장 단위 테스트 | Dev Open Library</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="9장 단위 테스트" /> <meta property="og:locale" content="en" /> <meta name="description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." /> <meta property="og:description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." /> <link rel="canonical" href="http://localhost:4000/chapter9-unit-test.html" /> <meta property="og:url" content="http://localhost:4000/chapter9-unit-test.html" /> <meta property="og:site_name" content="Dev Open Library" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="9장 단위 테스트" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A minimal, responsive and feature-rich Jekyll theme for technical writing.","headline":"9장 단위 테스트","url":"http://localhost:4000/chapter9-unit-test.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Dev Open Library </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Clean Code Study</a></li><li class="nav-list-item"><a href="/chapter1-clean-code.html" class="nav-list-link">1장 깨끗한 코드</a></li><li class="nav-list-item"><a href="/chapter2-meaningful-names.html" class="nav-list-link">2장 의미 있는 이름</a></li><li class="nav-list-item"><a href="/chapter3-function.html" class="nav-list-link">3장 함수</a></li><li class="nav-list-item"><a href="/chapter4-annotation.html" class="nav-list-link">4장 주석</a></li><li class="nav-list-item"><a href="/chapter5-consistent-formatting%20.html" class="nav-list-link">5장 형식 맞추기</a></li><li class="nav-list-item"><a href="/chpater6-obejct-and-data-structure.html" class="nav-list-link">6장 객체와 자료구조</a></li><li class="nav-list-item"><a href="/chapter7-error-handling.html" class="nav-list-link">7장 오류 처리</a></li><li class="nav-list-item"><a href="/chapter8-boundary.html" class="nav-list-link">8장 경계</a></li><li class="nav-list-item"><a href="/chapter9-unit-test.html" class="nav-list-link">9장 단위 테스트</a></li><li class="nav-list-item"><a href="/chapter10-class.html" class="nav-list-link">10장 클래스</a></li><li class="nav-list-item"><a href="/chapter11-system.html" class="nav-list-link">11장 시스템</a></li><li class="nav-list-item"><a href="/chapter12-emergence.html" class="nav-list-link">12장 창발성</a></li><li class="nav-list-item"><a href="/chapter13-concurrency.html" class="nav-list-link">13장 동시성</a></li><li class="nav-list-item"><a href="/chapter14-incremental-improvement.html" class="nav-list-link">14장 점진적인 개선</a></li><li class="nav-list-item"><a href="/chapter15-junit.html" class="nav-list-link">15장 JUnit</a></li><li class="nav-list-item"><a href="/chapter16-SerialDate-refactoring.html" class="nav-list-link">16장 SerialDate 리팩토링</a></li><li class="nav-list-item"><a href="/chapter17-smell-and-heuristic.html" class="nav-list-link">17장 냄새와 휴리스틱</a></li><li class="nav-list-item"><a href="/appendix-concurrency.html" class="nav-list-link">동시성</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Dev Open Library" aria-label="Search Dev Open Library" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="9장-단위-테스트"> <a href="#9장-단위-테스트" class="anchor-heading" aria-labelledby="9장-단위-테스트"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 9장 단위 테스트 </h1> <p>TDD라는 개념이 생소하던 시절, 우리들 대다수에게 단위 테스트란 자기 프로그램이 돌아간다는 사실만 확인하는 일회성 코드에 불과했다.</p> <p>하지만 10년 동안 우리 분야는 눈부신 성장을 이뤘다. 애자일과 TDD 덕택에 단위 테스트를 자동화하는 프로그래머들이 이미 많아졌으며 점점 더 늘어나는 추세다.</p> <p>하지만 우리 분야에 테스트를 추가하려고 급하게 서두르는 와중에 많은 프로그래머들이 제대로 된 테스트 케이스를 작성해야 한다는 좀 더 미묘한(그리고 더욱 중요한) 사실을 놓쳐버렸다.</p> <h2 id="tdd-법칙-세-가지"> <a href="#tdd-법칙-세-가지" class="anchor-heading" aria-labelledby="tdd-법칙-세-가지"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> TDD 법칙 세 가지 </h2> <ul> <li><strong>첫째 법칙</strong> : 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.</li> <li><strong>둘째 법칙</strong> : 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.</li> <li><strong>셋째 법칙</strong> : 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.</li> </ul> <p>위 세 가지 규칙을 따르면 개발과 테스트가 대략 30초 주기로 묶이며, 매일 수십 개, 매달 수백 개, 매년 수천 개에 달하는 테스트 케이스가 나온다.</p> <p>이러한 방대한 테스트 코드는 심각한 관리 문제를 유발하기도 한다.</p> <h2 id="깨끗한-테스트-코드-유지하기"> <a href="#깨끗한-테스트-코드-유지하기" class="anchor-heading" aria-labelledby="깨끗한-테스트-코드-유지하기"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 깨끗한 테스트 코드 유지하기 </h2> <p>몇 년전, 테스트 코드의 품질에 신경 쓰지않고, “<em>지저분해도 빨리</em>“라는 주 제어하에 테스트를 진행하는 팀의 코치를 맡은 경험이 있다.</p> <p>실제 코드에 변경이 생기면, 테스트 코드도 변해야 한다. 그런데 만일 <strong>테스트 코드가 지저분하다면, 변경하기 어려워진다.</strong></p> <p>테스트 코드가 복잡할수록 실제 코드를 짜는 시간보다 테스트 케이스를 추가하는 시간이 더 걸리기 십상이다. 실제 코드를 변경해 기존 테스트 케이스가 실패하기 시작하면, 지저분한 테스트코드로 인해, 실패하는 테스트 케이스를 점점 더 통과시키기 어려워진다. <strong>그래서 테스트 코드는 계속해서 늘어나는 부담이 되버린다.</strong></p> <p>새 버전을 출시할 때마다 팀이 테스트 케이스를 유지하고 보수하는 비용도 점차 늘어난다. 이제 점차 테스트 코드는 개발자 사이에서 불만으로 자리잡는다. 따라서 테스트 슈트를 폐기하지 않으면 안 되는 상황에 처한다.</p> <blockquote> <p>테스트 슈트는 테스트 케이스들의 집합으로, 특정 테스트 목표나 기능 단위로 관련된 테스트 케이스들을 그룹화한 것을 뜻한다.</p> </blockquote> <p>하지만 테스트 슈트가 없으면 개발자는 자신이 수정한 코드가 제대로 동작하는지 확인할 방법이 없다. 그래서 결함율이 높아지고, 변경에 대해 주저하게 된다.</p> <p>결국 테스트 슈트도 없고, 코드는 뒤섞이고, 테스트에 쏟아 부은 노력이 허사였다는 실망감만 남는다.</p> <p>이 이야기가 전하는 교훈은 “<strong>테스트 코드는 실제 코드 못지 않게 중요하다</strong>” 는 점이다.</p> <h3 id="테스트는-유연성-유지보수성-재사용성을-제공한다"> <a href="#테스트는-유연성-유지보수성-재사용성을-제공한다" class="anchor-heading" aria-labelledby="테스트는-유연성-유지보수성-재사용성을-제공한다"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <em>테스트는 유연성, 유지보수성, 재사용성을 제공한다</em> </h3> <p>코드에 유연성, 유지보수성, 재사용성을 제공하는 버팀목이 바로 단위 테스트다. <strong>테스트 케이스가 있으면 변경이 두렵지 않고, 변경이 쉬워진다.</strong></p> <p>아무리 아키텍쳐가 유연하고, 설계를 잘 나눴더라도 테스트 케이스가 없으면 잠정적인 버그를 두려워해 변경을 주저하게 된다.</p> <p>하지만 반대로 테스트 케이스가 있다면 그러한 주저함은 사라진다. 오히려 아키텍처가 부실하더라도 별다른 우려없이 코드를 변경할 수 있다.</p> <p>그러므로 실제 코드를 점검하는 자동화된 단위 테스트 슈트는 설계와 아키텍처를 최대한 깨끗하게 보존하는 열쇠다.</p> <h2 id="깨끗한-테스트-코드"> <a href="#깨끗한-테스트-코드" class="anchor-heading" aria-labelledby="깨끗한-테스트-코드"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 깨끗한 테스트 코드 </h2> <p>깨끗한 테스트 코드를 만들기 위해 가장 중요한 것은 <strong>가독성</strong>이다.</p> <p>그렇다면 가독성을 높이기 위해 필요한 것은 명료성, 단순성, 풍부한 표현력이다. 테스트 코드는 최소한의 표현으로 많은 것을 나타내야 한다.</p> <p>목록 9-1은 FitNess에서 가져온 코드다. 세 개의 테스트 케이스는 이해하기 어렵기에 개선할 여지가 있다. 첫째, <code class="language-plaintext highlighter-rouge">addPage</code>와 <code class="language-plaintext highlighter-rouge">assertSubString</code>을 부르느라 중복된 코드가 매우 많다. 좀 더 중요하게는 자질구레한 사항이 너무 많아 테스트 코드의 표현력이 떨어진다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 목록 9-1 SerializedPageResponderTest.java</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetPageHierarchyAsXml</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">crawler</span><span class="o">.</span><span class="na">addPage</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageOne"</span><span class="o">));</span>
    <span class="n">crawler</span><span class="o">.</span><span class="na">addPage</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageOne.ChildOne"</span><span class="o">));</span>
    <span class="n">crawler</span><span class="o">.</span><span class="na">addPage</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageTwo"</span><span class="o">));</span>
    
    <span class="n">request</span><span class="o">.</span><span class="na">setResource</span><span class="o">(</span><span class="s">"root"</span><span class="o">);</span>
    <span class="n">request</span><span class="o">.</span><span class="na">addInput</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="s">"pages"</span><span class="o">);</span>
    
    <span class="nc">Responder</span> <span class="n">responder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SerializedPageResponder</span><span class="o">();</span>
    <span class="nc">SimpleResponse</span> <span class="n">response</span> <span class="o">=</span> 
        <span class="o">(</span><span class="nc">SimpleResponse</span><span class="o">)</span> <span class="n">responder</span><span class="o">.</span><span class="na">makeResponse</span><span class="o">(</span><span class="k">new</span> <span class="nc">FitNesseContext</span><span class="o">(</span><span class="n">root</span><span class="o">),</span> <span class="n">request</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span>
    
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"text/xml"</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">getContentType</span><span class="o">());</span>
    <span class="n">assertSubString</span><span class="o">(</span><span class="s">"&lt;name&gt;PageOne&lt;/name&gt;"</span><span class="o">,</span> <span class="n">xml</span><span class="o">);</span>
    <span class="n">assertSubString</span><span class="o">(</span><span class="s">"&lt;name&gt;PageTwo&lt;/name&gt;"</span><span class="o">,</span> <span class="n">xml</span><span class="o">);</span>
    <span class="n">assertSubString</span><span class="o">(</span><span class="s">"&lt;name&gt;ChildOne&lt;/name&gt;"</span><span class="o">,</span> <span class="n">xml</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetPageHierarchyAsXmlDoesntContainSymbolicLinks</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">WikiPage</span> <span class="n">pageOne</span> <span class="o">=</span> <span class="n">crawler</span><span class="o">.</span><span class="na">addPage</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageOne"</span><span class="o">));</span>
    <span class="n">crawler</span><span class="o">.</span><span class="na">addPage</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageOne.ChildOne"</span><span class="o">));</span>
    <span class="n">crawler</span><span class="o">.</span><span class="na">addPage</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageTwo"</span><span class="o">));</span>
    
    <span class="nc">PageData</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pageOne</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
    <span class="nc">WikiPageProperties</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">getProperties</span><span class="o">();</span>
    <span class="nc">WikiPageProperty</span> <span class="n">symLinks</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="nc">SymbolicPage</span><span class="o">.</span><span class="na">PROPERTY_NAME</span><span class="o">);</span>
    <span class="n">symLinks</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"SymPage"</span><span class="o">,</span> <span class="s">"PageTwo"</span><span class="o">);</span>
    <span class="n">pageOne</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    
    <span class="n">request</span><span class="o">.</span><span class="na">setResource</span><span class="o">(</span><span class="s">"root"</span><span class="o">);</span>
    <span class="n">request</span><span class="o">.</span><span class="na">addInput</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="s">"pages"</span><span class="o">);</span>
    
    <span class="nc">Responder</span> <span class="n">responder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SerializedPageResponder</span><span class="o">();</span>
    <span class="nc">SimpleResponse</span> <span class="n">response</span> <span class="o">=</span> 
        <span class="o">(</span><span class="nc">SimpleResponse</span><span class="o">)</span> <span class="n">responder</span><span class="o">.</span><span class="na">makeResponse</span><span class="o">(</span><span class="k">new</span> <span class="nc">FitNesseContext</span><span class="o">(</span><span class="n">root</span><span class="o">),</span> <span class="n">request</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span>
    
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"text/xml"</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">getContentType</span><span class="o">());</span>
    <span class="n">assertSubString</span><span class="o">(</span><span class="s">"&lt;name&gt;PageOne&lt;/name&gt;"</span><span class="o">,</span> <span class="n">xml</span><span class="o">);</span>
    <span class="n">assertSubString</span><span class="o">(</span><span class="s">"&lt;name&gt;PageTwo&lt;/name&gt;"</span><span class="o">,</span> <span class="n">xml</span><span class="o">);</span>
    <span class="n">assertSubString</span><span class="o">(</span><span class="s">"&lt;name&gt;ChildOne&lt;/name&gt;"</span><span class="o">,</span> <span class="n">xml</span><span class="o">);</span>
    <span class="n">assertNotSubString</span><span class="o">(</span><span class="s">"SymPage"</span><span class="o">,</span> <span class="n">xml</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetDataAsHtml</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">crawler</span><span class="o">.</span><span class="na">addPage</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"TestPageOne"</span><span class="o">),</span> <span class="s">"test page"</span><span class="o">);</span>
    
    <span class="n">request</span><span class="o">.</span><span class="na">setResource</span><span class="o">(</span><span class="s">"TestPageOne"</span><span class="o">);</span>
    <span class="n">request</span><span class="o">.</span><span class="na">addInput</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="s">"data"</span><span class="o">);</span>
    
    <span class="nc">Responder</span> <span class="n">responder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SerializedPageResponder</span><span class="o">();</span>
    <span class="nc">SimpleResponse</span> <span class="n">response</span> <span class="o">=</span> 
        <span class="o">(</span><span class="nc">SimpleResponse</span><span class="o">)</span> <span class="n">responder</span><span class="o">.</span><span class="na">makeResponse</span><span class="o">(</span><span class="k">new</span> <span class="nc">FitNesseContext</span><span class="o">(</span><span class="n">root</span><span class="o">),</span> <span class="n">request</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span>
    
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"text/xml"</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">getContentType</span><span class="o">());</span>
    <span class="n">assertSubString</span><span class="o">(</span><span class="s">"test page"</span><span class="o">,</span> <span class="n">xml</span><span class="o">);</span>
    <span class="n">assertSubString</span><span class="o">(</span><span class="s">"&lt;Test"</span><span class="o">,</span> <span class="n">xml</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div></div> <p>예를 들어, <code class="language-plaintext highlighter-rouge">PathParser</code> 호출을 살펴보자. <code class="language-plaintext highlighter-rouge">PathParser는</code> 문자열을 <code class="language-plaintext highlighter-rouge">pagePath</code> 인스턴스로 변환한다. 이는 웹 크롤러가 사용하는 객체로 테스트에 무관하며 테스트 코드의 의도를 흐린다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">crawler</span><span class="o">.</span><span class="na">addPage</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageOne"</span><span class="o">));</span>
<span class="n">crawler</span><span class="o">.</span><span class="na">addPage</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageOne.ChildOne"</span><span class="o">));</span>
<span class="n">crawler</span><span class="o">.</span><span class="na">addPage</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="nc">PathParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"PageTwo"</span><span class="o">));</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">responsder</code>객체를 생성하는 코드와 <code class="language-plaintext highlighter-rouge">response</code>를 수집해 변환하는 코드 역시 잡음에 불과하다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Responder</span> <span class="n">responder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SerializedPageResponder</span><span class="o">();</span>
<span class="nc">SimpleResponse</span> <span class="n">response</span> <span class="o">=</span> 
        <span class="o">(</span><span class="nc">SimpleResponse</span><span class="o">)</span> <span class="n">responder</span><span class="o">.</span><span class="na">makeResponse</span><span class="o">(</span><span class="k">new</span> <span class="nc">FitNesseContext</span><span class="o">(</span><span class="n">root</span><span class="o">),</span> <span class="n">request</span><span class="o">);</span>
<span class="nc">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span>
</code></pre></div></div> <p>이 코드는 읽는 사람을 고려하지 않는다. 테스트와 무관한 코드가 도처에 남발되어있어, 정작 중요한 테스트 케이스를 이해하는데 방해된다.</p> <p>이제 목록 9-2를 살펴보자. 목록 9-1을 개선한 코드로, 목록 9-1과 정확히 동일한 테스트를 수행한다. 하지만 좀 더 깨끗하고 이해하기 쉽다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 목록 9-2 SerializedPageResponderTest.java (리팩터링한 코드)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetPageHierarchyAsXml</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// BUILD</span>
    <span class="n">makePages</span><span class="o">(</span><span class="s">"PageOne"</span><span class="o">,</span> <span class="s">"PageOne.ChildOne"</span><span class="o">,</span> <span class="s">"PageTwo"</span><span class="o">);</span>

    <span class="c1">// OPERATE</span>
    <span class="n">submitRequest</span><span class="o">(</span><span class="s">"root"</span><span class="o">,</span> <span class="s">"type:pages"</span><span class="o">);</span>

    <span class="c1">// CHECK</span>
    <span class="n">assertResponseIsXML</span><span class="o">();</span>
    <span class="n">assertResponseContains</span><span class="o">(</span>
        <span class="s">"&lt;name&gt;PageOne&lt;/name&gt;"</span><span class="o">,</span> <span class="s">"&lt;name&gt;PageTwo&lt;/name&gt;"</span><span class="o">,</span> <span class="s">"&lt;name&gt;ChildOne&lt;/name&gt;"</span>
    <span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSymbolicLinksAreNotInXmlPageHierarchy</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// BUILD</span>
    <span class="nc">WikiPage</span> <span class="n">page</span> <span class="o">=</span> <span class="n">makePage</span><span class="o">(</span><span class="s">"PageOne"</span><span class="o">);</span>
    <span class="n">makePages</span><span class="o">(</span><span class="s">"PageOne.ChildOne"</span><span class="o">,</span> <span class="s">"PageTwo"</span><span class="o">);</span>

    <span class="c1">// OPERATE</span>
    <span class="n">addLinkTo</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="s">"PageTwo"</span><span class="o">,</span> <span class="s">"SymPage"</span><span class="o">);</span>


    <span class="n">submitRequest</span><span class="o">(</span><span class="s">"root"</span><span class="o">,</span> <span class="s">"type:pages"</span><span class="o">);</span>


    <span class="c1">// CHECK</span>
    <span class="n">assertResponseIsXML</span><span class="o">();</span>
    <span class="n">assertResponseContains</span><span class="o">(</span>
        <span class="s">"&lt;name&gt;PageOne&lt;/name&gt;"</span><span class="o">,</span> <span class="s">"&lt;name&gt;PageTwo&lt;/name&gt;"</span><span class="o">,</span> <span class="s">"&lt;name&gt;ChildOne&lt;/name&gt;"</span>
    <span class="o">);</span>
    <span class="n">assertResponseDoesNotContain</span><span class="o">(</span><span class="s">"SymPage"</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetDataAsXml</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// BUILD</span>
    <span class="n">makePageWithContent</span><span class="o">(</span><span class="s">"TestPageOne"</span><span class="o">,</span> <span class="s">"test page"</span><span class="o">);</span>


    <span class="c1">// OPERATE</span>
    <span class="n">submitRequest</span><span class="o">(</span><span class="s">"TestPageOne"</span><span class="o">,</span> <span class="s">"type:data"</span><span class="o">);</span>


    <span class="c1">// CHECK</span>
    <span class="n">assertResponseIsXML</span><span class="o">();</span>
    <span class="n">assertResponseContains</span><span class="o">(</span><span class="s">"test page"</span><span class="o">,</span> <span class="s">"&lt;Test"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>BUILD-OPERATE-CHECK 패턴이 위와 같은 테스트 구조에 적합하다.</p> <p>BUILD-OPERATE-CHECK 패턴은 테스트 코드 작성 시 가독성을 높이기 위한 구조화된 접근 이다. 이 패턴은 테스트를 세 가지 명확한 단계로 나누어 진행한다.</p> <ul> <li> <p><strong>BUILD 단계</strong> : 테스트에 필요한 자료와 환경을 구성하는 단계. Given 단계와 유사한 개념으로, 입력 데이터를 준비한다.</p> </li> <li> <p><strong>OPERATE 단계</strong> : 준비된 테스트 자료를 실제로 조작하는 단계. When 단계와 유사하게, 실제 코드를 실행하는 과정.</p> </li> <li> <p><strong>CHECK 단계</strong> : OPERATE 단계의 결과를 검증하는 단계. 이 단계에서 assert 문을 사용하여 테스트 결과를 판단한다. Then 단계와 유사한 개념이다.</p> </li> </ul> <p>또한 잡다하고 세세한 코드를 거의 다 없앴다는 사실에 주목해야 한다. 그러므로 읽는 사람은 필요없는 코드에 헷갈릴 필요가 없고, 코드가 수행하는 기능에 집중할 수 있게 된다.</p> <h3 id="도메인에-특화된-테스트-언어"> <a href="#도메인에-특화된-테스트-언어" class="anchor-heading" aria-labelledby="도메인에-특화된-테스트-언어"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <em>도메인에 특화된 테스트 언어</em> </h3> <p>목록 9-2는 도메인에 특화된 언어(DSL)로 테스트 코드를 구현하는 기법을 보여준다.</p> <p>흔히 쓰는 시스템 조작 API를 사용하는 대신, API위에 함수와 유틸리티를 구현한다. 즉, 이러한 함수와 유틸리티는 당사자와 나중에 테스트를 읽을 사람을 도와주는 테스트 <strong>언어</strong>가 된다.</p> <p>이런 테스트 API는 처음부터 설계된 API가 아니다. 계속 리팩터링한 결과이며, 숙련된 개발자라면 자기 코드를 좀 더 간결하고 표현력이 풍부한 코드로 리팩터링해야 한다.</p> <h3 id="이중-표준"> <a href="#이중-표준" class="anchor-heading" aria-labelledby="이중-표준"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <em>이중 표준</em> </h3> <p><strong>테스트 API코드에 적용하는 표준과 실제 코드에 적용하는 표준은 다르다.</strong></p> <p>단순하고, 간결하고, 표현력이 풍부해야 하지만, 실제 코드만큼 효율적인 필요는 없다. 실제 환경이 아닌 테스트 환경에서 돌아가는 코드이기 때문이다.</p> <p>목록 9-3을 살펴보자. 환경 제어 시스템에 속한 테스트 코드다. 세세하게 설명하지 않더라도 온도가 “급격하게 떨어지면” 경보, 온풍기, 송풍기가 모두 가동되는지 확인하는 코드라는 사실이 드러난다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 목록 9-3 EnvironmentControllerTest.java</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnOnLoTempAlarmAtThreshold</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">hw</span><span class="o">.</span><span class="na">setTemp</span><span class="o">(</span><span class="no">WAY_TOO_COLD</span><span class="o">);</span>
    <span class="n">controller</span><span class="o">.</span><span class="na">tic</span><span class="o">();</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">hw</span><span class="o">.</span><span class="na">heaterState</span><span class="o">());</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">hw</span><span class="o">.</span><span class="na">blowerState</span><span class="o">());</span>
    <span class="n">assertFalse</span><span class="o">(</span><span class="n">hw</span><span class="o">.</span><span class="na">coolerState</span><span class="o">());</span>
    <span class="n">assertFalse</span><span class="o">(</span><span class="n">hw</span><span class="o">.</span><span class="na">hiTempAlarm</span><span class="o">());</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">hw</span><span class="o">.</span><span class="na">loTempAlarm</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div> <p>목록 9-3을 읽다보면 눈길이 이리저리 흩어져, 읽기 어렵다. 그래서 목록 9-4로 변홚해 코드 가독성을 크게 높였다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 목록 9-4 EnvironmentControllerTest.java (리팩터링)</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnOnLoTempAlarmAtThreshold</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">wayTooCold</span><span class="o">();</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"HBchL"</span><span class="o">,</span> <span class="n">hw</span><span class="o">.</span><span class="na">getState</span><span class="o">())</span> <span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>목록 9-3의 <code class="language-plaintext highlighter-rouge">tic</code> 함수는 <code class="language-plaintext highlighter-rouge">wayTooColod</code>라는 함수 내부에 숨겼다. 그런데 <code class="language-plaintext highlighter-rouge">assertEquals</code>에 들어있는 이상한 문자열(“HBchL”)은 무엇일까?</p> <p>이는 대문자는 “켜짐”이고 소문자는 “꺼짐”임을 뜻하며, 문자의 순서는 {heater, blower, cooler, hi-temp-alarm, lo-temp-alarm} 이다.</p> <p>즉 “HBchL” 이라는 문자열은 heater, blower, lo-temp-alarm 이 “켜짐” 상태이고, cooler, hi-temp-alarm 은 “꺼짐” 상태임을 나타낸다.</p> <p>위의 방식이 <em>그릇된 정보를 피하라</em>(코드에 코드의 의미를 흐리는 단어를 남기는)는 규칙의 위반에 가깝지만, 여기서는 적절해보인다. 앞서 말했듯, 테스트 코드와 실제 코드의 환경은 다르다. 일단 의미만 안다면, 코드를 이하는 것은 훨씬 쉬워질 것이다. 이는 목록 9-5를 보면 알수 있다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 목록 9-5 EnvironmentControllerTest.java (더 복잡한 선택)</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnOnCoolerAndBlowerIfTooHot</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">tooHot</span><span class="o">();</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"hBChl"</span><span class="o">,</span> <span class="n">hw</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnOnHeaterAndBlowerIfTooCold</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">tooCold</span><span class="o">();</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"HBchl"</span><span class="o">,</span> <span class="n">hw</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnOnHiTempAlarmAtThreshold</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">wayTooHot</span><span class="o">();</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"hBCHL"</span><span class="o">,</span> <span class="n">hw</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnOnLoTempAlarmAtThreshold</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">wayTooCold</span><span class="o">();</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"HBchL"</span><span class="o">,</span> <span class="n">hw</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div> <p>목록 9-6은 <code class="language-plaintext highlighter-rouge">getState</code>함수를 보여준다. 코드가 그리 효율적이지 못하며, 효율을 높이려면 <code class="language-plaintext highlighter-rouge">StringBuffer</code>가 더 적합하다. 하지만, 실제로 <code class="language-plaintext highlighter-rouge">StringBuffuer</code>를 사용하지 않아 치르는 대가는 미미하다.</p> <p>이는 테스트 환경과 실제 애플리케이션 환경은 다름을 시사한다. <strong>이것이 이중 표준의 본질이다. 실제 환경에서는 절대로 안 되지만 테스트 환경에서는 전혀 문제없는 방식이 있다.</strong> 대게 메모리나 CPU 효율과 관련 있는 경우다. <strong>코드의 깨끗함과는 철저히 무관하다.</strong></p> <h2 id="테스트-당-assert-하나"> <a href="#테스트-당-assert-하나" class="anchor-heading" aria-labelledby="테스트-당-assert-하나"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 테스트 당 assert 하나 </h2> <p>assert 문이 단 하나인 함수는 결론이 하나라서 코드를 이해하기 쉽고 빠르다.</p> <p>하지만 목록 9-2는 어떨까? “출력이 XML이다”라는 assert 문과 “특정 문자열을 포함한다”는 assert 문을 하나로 병합하는 방식이 불합리해 보인다. 하지만 목록 9-7에서 보듯이 테스트를 두 개로 쪼개 각자가 assert를 수행하게 된다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 목록 9-7 SerializedPageResponderTest.java (단일 assert)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetPageHierarchyAsXml</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">givenPages</span><span class="o">(</span><span class="s">"PageOne"</span><span class="o">,</span> <span class="s">"PageOne.ChildOne"</span><span class="o">,</span> <span class="s">"PageTwo"</span><span class="o">);</span>


    <span class="n">whenRequestIsIssued</span><span class="o">(</span><span class="s">"root"</span><span class="o">,</span> <span class="s">"type:pages"</span><span class="o">);</span>


    <span class="n">thenResponseShouldBeXML</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetPageHierarchyHasRightTags</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">givenPages</span><span class="o">(</span><span class="s">"PageOne"</span><span class="o">,</span> <span class="s">"PageOne.ChildOne"</span><span class="o">,</span> <span class="s">"PageTwo"</span><span class="o">);</span>


    <span class="n">whenRequestIsIssued</span><span class="o">(</span><span class="s">"root"</span><span class="o">,</span> <span class="s">"type:pages"</span><span class="o">);</span>


    <span class="n">thenResponseShouldContain</span><span class="o">(</span>
        <span class="s">"&lt;name&gt;PageOne&lt;/name&gt;"</span><span class="o">,</span> <span class="s">"&lt;name&gt;PageTwo&lt;/name&gt;"</span><span class="o">,</span> <span class="s">"&lt;name&gt;ChildOne&lt;/name&gt;"</span>
    <span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>위에서 함수 이름을 바꿔 given-when-then이라는 관례를 사용했다는 사실에 주목한다. 그러면 테스트 코드를 읽기가 쉬워진다. 하지만 불행하게도, 위에서 보듯이, 테스트를 분리하면 중복되는 코드가 많아진다.</p> <p>TEMPLATE METHOD 패턴을 사용하면 중복을 제거할 수 있다. given/when 부분을 부모 클래스에 두고 then 부분을 자식 클래스에 두면된다.</p> <blockquote> <p>템플릿 메소드(Template Method) 패턴은 알고리즘의 구조를 정의하고 일부 단계를 서브클래스에서 구현할 수 있도록 하는 행동 디자인 패턴이다.</p> </blockquote> <p>혹은, 완전히 독자적인 테스트 클래스를 만들어 <code class="language-plaintext highlighter-rouge">@Before</code> 함수에 given.when 부분을 넣고 <code class="language-plaintext highlighter-rouge">@Test</code> 함수에 then 부분을 넣어도 된다.</p> <p>하지만 모두가 배보다 배꼽이 더 크다. 결국 목록 9-2 처럼 assert 문을 여럿 사용하는 편이 좋다고 생각한다.</p> <p>‘단일 assert 문’이라는 규칙이 훌륭한 지침이라고 생각한다. 하지만 때로는 주저 없이 함수 하나에 여러 assert 문을 넣기도 한다. 단지 assert 문 개수를 최대한 줄여야 좋다는 생각이다.</p> <h3 id="테스트-당-개념-하나"> <a href="#테스트-당-개념-하나" class="anchor-heading" aria-labelledby="테스트-당-개념-하나"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <em>테스트 당 개념 하나</em> </h3> <p>어쩌면 “<em>테스트 함수마다 한 개념만 테스트하라</em>“는 규칙이 더 낫겠다.</p> <p>목록 9-8은 바람직하지 못한 테스트 함수다. 독자적인 개념 세 개를 테스트 하므로, 독자적인 테스트 함수 세 개로 쪼개야 마땅하다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * 목록 9-8
 *  addMonths() 메서드를 테스트하는 장황한 코드 
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAddMonths</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">SerialDate</span> <span class="n">d1</span> <span class="o">=</span> <span class="nc">SerialDate</span><span class="o">.</span><span class="na">createInstance</span><span class="o">(</span><span class="mi">31</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">2004</span><span class="o">);</span>
    <span class="nc">SerialDate</span> <span class="n">d2</span> <span class="o">=</span> <span class="nc">SerialDate</span><span class="o">.</span><span class="na">addMonths</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">d1</span><span class="o">);</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">30</span><span class="o">,</span> <span class="n">d2</span><span class="o">.</span><span class="na">getDayOfMonth</span><span class="o">());</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="n">d2</span><span class="o">.</span><span class="na">getMonth</span><span class="o">());</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">2004</span><span class="o">,</span> <span class="n">d2</span><span class="o">.</span><span class="na">getYY</span><span class="o">());</span>
    
    <span class="nc">SerialDate</span> <span class="n">d3</span> <span class="o">=</span> <span class="nc">SerialDate</span><span class="o">.</span><span class="na">addMonths</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">d1</span><span class="o">);</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">31</span><span class="o">,</span> <span class="n">d3</span><span class="o">.</span><span class="na">getDayOfMonth</span><span class="o">());</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="n">d3</span><span class="o">.</span><span class="na">getMonth</span><span class="o">());</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">2004</span><span class="o">,</span> <span class="n">d3</span><span class="o">.</span><span class="na">getYY</span><span class="o">());</span>
    
    <span class="nc">SerialDate</span> <span class="n">d4</span> <span class="o">=</span> <span class="nc">SerialDate</span><span class="o">.</span><span class="na">addMonths</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">SerialDate</span><span class="o">.</span><span class="na">addMonths</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">d1</span><span class="o">));</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">30</span><span class="o">,</span> <span class="n">d4</span><span class="o">.</span><span class="na">getDayOfMonth</span><span class="o">());</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="n">d4</span><span class="o">.</span><span class="na">getMonth</span><span class="o">());</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">2004</span><span class="o">,</span> <span class="n">d4</span><span class="o">.</span><span class="na">getYY</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div> <p>셋으로 분리한 테스트 함수는 각각 다음 기능을 수행한다.</p> <ul> <li> <p>(5월처럼) 31일로 끝나는 달의 마지막 날짜가 주어지는 경우</p> <ol> <li>(6월처럼) 30일로 끝나는 한 달을 더하면 날짜는 30일이 되어야지 31일이 되어서는 안된다.</li> <li>두 달을 더하면 그리고 두 번째 달이 31일로 끝나면 날짜는 31일이 되어야 한다.</li> </ol> </li> <li> <p>(6월처럼) 30일로 끝나는 달의 마지막 날짜가 주어지는 경우</p> <ol> <li>31일로 끝나는 한 달을 더하면 날짜는 30일이 되어야지 31일이 되면 안된다.</li> </ol> </li> </ul> <p>이렇게 표현하면 일반적인 규칙이 보인다. 즉, 목록 9-8의 문제는 assert 문이 여럿이라는 점이 아니라는 것이다. 한 테스트 함수에서 여러 개념을 테스트한다는 사실이 문제다.</p> <p>그러므로 가장 좋은 규칙은 <strong>“개념 당 assert 문 수를 최소로 줄여라”</strong>와 <strong>“테스트 함수 하나는 개념 하나만 테스트하라”</strong>라 할 수 있겠다.</p> <h2 id="first"> <a href="#first" class="anchor-heading" aria-labelledby="first"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> F.I.R.S.T </h2> <p>깨끗한 테스트는 다음 다섯 가지 규칙을 따른다.</p> <ol> <li>빠르게(Fast) : <strong>테스트는 빠른 주기로 돌려야 한다.</strong> 자주 돌리지 않으면 문제를 찾아내거나, 코드를 정리하기 어렵다.</li> <li>독립적으로(Independent) : <strong>각 테스트는 서로 의존하면 안 된다.</strong> 한 테스트가 다음 테스트가 실행될 환경을 준비해서는 안된다. 테스트들이 서로 의존하면 결과가 서로 영향을 미쳐 원인을 파악하기 어려워 진다.</li> <li>반복가능하게(Repeatable) : <strong>테스트는 어떤 환경에서도 반복 가능해야한다.</strong> 테스트가 돌아가지 않는 환경이 하나라도 있다면 테스트가 실패한 이유를 둘러댈 변명이 생긴다.</li> <li>자가검증하는(Self-Validating) : <strong>테스트는 부울 값으로 결과를 내야 한다.</strong> 예를 들어 통과 여부를 알려고 로그 파일을 읽게 해서는 안된다. 테스트 스스로 성공과 실패를 가늠하지 못한다면, 판단은 주관적이 된다.</li> <li>적시에(Timely) : <strong>테스트는 적시에 작성해야 한다.</strong> 단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현한다.</li> </ol> <h2 id="결론"> <a href="#결론" class="anchor-heading" aria-labelledby="결론"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 결론 </h2> <p>테스트 코드는 실제 코드만큼이나 프로젝트 건강에 중요하다. 테스트 코드는 실제 코드의 유연성, 유지보수성, 재사용성을 보존하고 강화하기 때문이다. 그러므로 테스트 코드는 지속적으로 깨끗하게 관리하자.</p> <p>표현력을 높이고 간결하게 정리하자. 테스트 API를 따로 구현해 도메인 특화 언어로 만들자.</p> <p>테스트 코드가 방치되어 망가지면 실제 코드도 망가진다. 테스트 코드를 깨끗하게 유지하자.</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
